# 101.3 Alterar os RunLevels Shutdown e Reboot 

Trata dos gerenciadores de inicialização.

Os três principais gerenciadores de inicialização são:

1. SystemV (SysV) - init original (Processo padrão do Unix);
2. systemd (mais utilizado). Compativel com SysV;
3. Upstart - gerenciador de serviços substituto ao init.

Xubuntu é o systemd.

## SystemV - init

Trabalha com a ideia de Runlevels (niveis de execução que iniciam determinados grupos de serviços);

Configuração principal `/etc/inittab`

Diretórios de Scripts

`/etc/init.d`
`/etc/rc.d`

### Runlevels

São 7 os tipos:

0 - desligamento
6 - reinicialização;
1, s, S - modo single. Modo de recuperação. Maioria dos serviços não está ativa (apenas root);
2 a 5 - modo de multiusuário (varia muito de distribuição).

### inittab - arquivo de configuração principal do init

**Não existe no Xubuntu**. Apresenta a configuração do runlevel default. Para saber o id do initdefault procurar pela linha que contenha `initdefault`. No caso abaixo o default é runlevel 2.

Mostra o que será executado em cada runlevel. `l0` referente ao runlevel 0, ação `wait` esperar o comando anterior e esperar que ele retorne algo, executar o script `/etc/init.d/rc` com o parâmetro `0`.

```console
# Arquivo exemplo criado na aula

# Runlevel default
id:2:initdefault

# id:runlevels:actions:process
l0:0:wait:/etc/init.d/rc 0
l1:1:wait:/etc/init.d/rc 1
l2:2:wait:/etc/init.d/rc 2
l3:3:wait:/etc/init.d/rc 3
l4:4:wait:/etc/init.d/rc 4

```

### /etc/init.d - diretório onde reside os serviços

Há vários arquivos referentes aos serviços. É possível executar esses serviços.

```console
daniel@linux:~$ cd /etc/init.d

daniel@linux:/etc/init.d$ ls
acpid             cups-browsed       lm-sensors       speech-dispatcher
alsa-utils        dbus               network-manager  spice-vdagent
anacron           grub-common        plymouth         udev
apparmor          hddtemp            plymouth-log     ufw
apport            hwclock.sh         pppd-dns         unattended-upgrades
avahi-daemon      irqbalance         procps           uuidd
bluetooth         kerneloops         rsync            whoopsie
console-setup.sh  keyboard-setup.sh  rsyslog          x11-common
cron              kmod               saned
cups              lightdm            screen-cleanup

```

Executando o serviço do `cron` (serviço de agendamento de tarefas do windows)

```console
daniel@linux:/etc/init.d$ ./cron status
● cron.service - Regular background program processing daemon
   Loaded: loaded (/lib/systemd/system/cron.service; enabled; vendor preset: enabled)
   Active: active (running) since Mon 2018-12-17 23:42:45 -02; 24min ago
     Docs: man:cron(8)
 Main PID: 484 (cron)
    Tasks: 1 (limit: 2320)
   CGroup: /system.slice/cron.service
           └─484 /usr/sbin/cron -f

dez 17 23:42:45 linux systemd[1]: Started Regular background program proces…mon.
dez 17 23:42:45 linux cron[484]: (CRON) INFO (pidfile fd = 3)
dez 17 23:42:45 linux cron[484]: (CRON) INFO (Running @reboot jobs)
Hint: Some lines were ellipsized, use -l to show in full.

```

### Diretórios rc - Diretório para cada runlevel



```console
daniel@linux:/etc/init.d$ cd /etc/

daniel@linux:/etc$ ls -ld rc*
drwxr-xr-x 2 root root 4096 nov 16 12:25 rc0.d
drwxr-xr-x 2 root root 4096 nov 16 12:25 rc1.d
drwxr-xr-x 2 root root 4096 nov 16 12:25 rc2.d
drwxr-xr-x 2 root root 4096 nov 16 12:25 rc3.d
drwxr-xr-x 2 root root 4096 nov 16 12:25 rc4.d
drwxr-xr-x 2 root root 4096 nov 16 12:25 rc5.d
drwxr-xr-x 2 root root 4096 nov 16 12:25 rc6.d
drwxr-xr-x 2 root root 4096 nov 25 00:47 rcS.d

```

Ao entrar em `rc5.d` há todos os serviços que devem ser iniciados ou parados. Quando os links iniciam com a letra S significa start do serviço (Ex.: `S01acpid`) enquanto se iniciar com K o runlevel matará esse serviço.

```console
daniel@linux:/etc$ cd rc5.d

daniel@linux:/etc/rc5.d$ ls -l
total 0
lrwxrwxrwx 1 root root 15 nov 16 12:16 S01acpid -> ../init.d/acpid
lrwxrwxrwx 1 root root 17 nov 16 12:16 S01anacron -> ../init.d/anacron
lrwxrwxrwx 1 root root 16 nov 16 12:16 S01apport -> ../init.d/apport
lrwxrwxrwx 1 root root 22 nov 16 12:16 S01avahi-daemon -> ../init.d/avahi-daemon
lrwxrwxrwx 1 root root 19 nov 16 12:16 S01bluetooth -> ../init.d/bluetooth
lrwxrwxrwx 1 root root 26 nov 16 12:16 S01console-setup.sh -> ../init.d/console-setup.sh
lrwxrwxrwx 1 root root 14 nov 16 12:16 S01cron -> ../init.d/cron
lrwxrwxrwx 1 root root 14 nov 16 12:16 S01cups -> ../init.d/cups
lrwxrwxrwx 1 root root 22 nov 16 12:16 S01cups-browsed -> ../init.d/cups-browsed
lrwxrwxrwx 1 root root 14 nov 16 12:16 S01dbus -> ../init.d/dbus
lrwxrwxrwx 1 root root 21 nov 16 12:16 S01grub-common -> ../init.d/grub-common
lrwxrwxrwx 1 root root 17 nov 16 12:16 S01hddtemp -> ../init.d/hddtemp
lrwxrwxrwx 1 root root 20 nov 16 12:16 S01irqbalance -> ../init.d/irqbalance
lrwxrwxrwx 1 root root 20 nov 16 12:16 S01kerneloops -> ../init.d/kerneloops
lrwxrwxrwx 1 root root 17 nov 16 12:16 S01lightdm -> ../init.d/lightdm
lrwxrwxrwx 1 root root 18 nov 16 12:16 S01plymouth -> ../init.d/plymouth
lrwxrwxrwx 1 root root 15 nov 16 12:16 S01rsync -> ../init.d/rsync
lrwxrwxrwx 1 root root 17 nov 16 12:16 S01rsyslog -> ../init.d/rsyslog
lrwxrwxrwx 1 root root 15 nov 16 12:16 S01saned -> ../init.d/saned
lrwxrwxrwx 1 root root 27 nov 16 12:16 S01speech-dispatcher -> ../init.d/speech-dispatcher
lrwxrwxrwx 1 root root 23 nov 16 12:16 S01spice-vdagent -> ../init.d/spice-vdagent
lrwxrwxrwx 1 root root 29 nov 16 12:16 S01unattended-upgrades -> ../init.d/unattended-upgrades
lrwxrwxrwx 1 root root 15 nov 16 12:16 S01uuidd -> ../init.d/uuidd
lrwxrwxrwx 1 root root 18 nov 16 12:16 S01whoopsie -> ../init.d/whoopsie

daniel@linux:/etc/rc5.d$ cd ../rc0.d
daniel@linux:/etc/rc0.d$ ls -l
total 0
lrwxrwxrwx 1 root root 20 nov 16 12:16 K01alsa-utils -> ../init.d/alsa-utils
lrwxrwxrwx 1 root root 22 nov 16 12:16 K01avahi-daemon -> ../init.d/avahi-daemon
lrwxrwxrwx 1 root root 19 nov 16 12:16 K01bluetooth -> ../init.d/bluetooth
lrwxrwxrwx 1 root root 22 nov 16 12:16 K01cups-browsed -> ../init.d/cups-browsed
lrwxrwxrwx 1 root root 17 nov 16 12:16 K01hddtemp -> ../init.d/hddtemp
lrwxrwxrwx 1 root root 20 nov 16 12:16 K01irqbalance -> ../init.d/irqbalance
lrwxrwxrwx 1 root root 20 nov 16 12:16 K01kerneloops -> ../init.d/kerneloops
lrwxrwxrwx 1 root root 17 nov 16 12:16 K01lightdm -> ../init.d/lightdm
lrwxrwxrwx 1 root root 18 nov 16 12:16 K01plymouth -> ../init.d/plymouth
lrwxrwxrwx 1 root root 17 nov 16 12:16 K01rsyslog -> ../init.d/rsyslog
lrwxrwxrwx 1 root root 15 nov 16 12:16 K01saned -> ../init.d/saned
lrwxrwxrwx 1 root root 27 nov 16 12:16 K01speech-dispatcher -> ../init.d/speech-dispatcher
lrwxrwxrwx 1 root root 23 nov 16 12:16 K01spice-vdagent -> ../init.d/spice-vdagent
lrwxrwxrwx 1 root root 29 nov 16 12:16 K01unattended-upgrades -> ../init.d/unattended-upgrades
lrwxrwxrwx 1 root root 15 nov 16 12:16 K01uuidd -> ../init.d/uuidd

```

### runlevel - comando para mostrar qual runlevel se está usando

Estamos atualmente no 5. Se mudar de runlevel, o comando mostra o anterior e o atual;

```console
daniel@linux:/etc/rc0.d$ runlevel
N 5
```

### init ou telinit - muda de runlevel

```console
init 1 - modo de recuperação

telinit 1

init 6  - reinicia a máquina
```
